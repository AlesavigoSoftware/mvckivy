#:kivy 2.3.0
#:import dp kivy.metrics.dp

MDScreen:
    md_bg_color: app.theme_cls.backgroundColor
    MDBoxLayout:
        orientation: "vertical"
        padding: dp(16)
        spacing: dp(16)

        MDLabel:
            text: "Диалог: ввод числа с внешней валидацией (0–65556)"
            halign: "left"
            font_style: "Title"
            role: "large"

        DialogPatchedTextField:
            id: port_field
            mode: "outlined"
            size_hint_x: 1
            input_type: "number"
            input_filter: "int"
            input_validator: app.number_validator
            hint_text: ""  # используем декларативный MDTextFieldHintText

            MDTextFieldLeadingIcon:
                icon: "cog"
                theme_icon_color: "Custom"
                # сразу задаём читаемые цвета; класс ещё раз продублирует это на всякий
                icon_color_normal: app.theme_cls.onSurfaceVariantColor
                icon_color_focus: app.theme_cls.onSurfaceVariantColor

            MDTextFieldHintText:
                text: "0–65556"

            MDTextFieldHelperText:
                text: port_field.error_message
                mode: "on_error"

        MDBoxLayout:
            adaptive_height: True
            MDButton:
                style: "filled"
                on_release: app.open_number_dialog()
                MDButtonText:
                    text: "Открыть диалог"

# ── Диалог ввода числа ───────────────────────────────────────────────────────
<NumberInputDialog>:
    radius: [dp(24)] * 4
    padding: dp(20)
    md_bg_color: self.theme_cls.surfaceContainerLowColor

    canvas.before:
        PushMatrix
        Scale:
            x: root.render_scale
            y: root.render_scale
            origin: self.center
    canvas.after:
        PopMatrix

    MDAdaptiveDialogIcon:
        icon: "numeric"

    MDAdaptiveDialogHeadlineText:
        text: "Введите значение"

    MDAdaptiveDialogSupportingText:
        text: "Разрешён диапазон: 0–65556"

    MDAdaptiveDialogContentContainer:
        orientation: "vertical"
        spacing: dp(8)

        DialogPatchedTextField:
            id: port_field
            mode: "outlined"
            size_hint_x: 1
            input_type: "number"
            input_filter: "int"
            input_validator: app.number_validator
            hint_text: ""  # используем декларативный MDTextFieldHintText

            MDTextFieldLeadingIcon:
                icon: "cog"
                theme_icon_color: "Custom"
                # сразу задаём читаемые цвета; класс ещё раз продублирует это на всякий
                icon_color_normal: app.theme_cls.onSurfaceVariantColor
                icon_color_focus: app.theme_cls.onSurfaceVariantColor

            MDTextFieldHintText:
                text: "0–65556"

            MDTextFieldHelperText:
                text: port_field.error_message
                mode: "on_error"

    MDAdaptiveDialogButtonContainer:
        spacing: dp(8)
        Widget:
        ScaledMDButton:
            scale_provider: root
            style: "text"
            on_release: root.dismiss()
            MDButtonText:
                text: "Отмена"
        ScaledMDButton:
            scale_provider: root
            style: "filled"
            on_release: root.accept()
            MDButtonText:
                text: "Сохранить"
