#:kivy 2.3.0
#:import dp kivy.metrics.dp
#:import MKVScrollView mvckivy.uix.scroll_view.MKVScrollView
#:import get_color_from_hex kivy.utils.get_color_from_hex
#:import MKVListItemHeadlineText mvckivy.uix.list.MKVListItemHeadlineText
#:import MKVBaseListItemText mvckivy.uix.list.MKVBaseListItemText

<MKVSettingsNav>:
    size_hint_y: None if root.axis == "x" else 1
    size_hint_x: 1 if root.axis == "x" else None
    height: dp(70) if root.axis == "x" else self.minimum_height
    width: dp(200) if root.axis == "y" else self.minimum_width
    items_container: items_container

    MKVScrollView:
        do_scroll_x: root.axis == "x"
        do_scroll_y: root.axis == "y"
        bar_width: dp(3)

        MDBoxLayout:
            id: items_container
            size_hint_x: None if root.axis == "x" else 1
            size_hint_y: 1 if root.axis == "x" else None
            width: self.minimum_width if root.axis == "x" else 1
            height: self.minimum_height if root.axis == "y" else 1
            orientation: "horizontal" if root.axis == "x" else "vertical"
            padding: dp(8), dp(4)
            spacing: dp(4)


<MKVSettingsNavItem>:
    size_hint: None, None
    height: dp(44)
    width: max(self.minimum_width, dp(120))
    padding: dp(16), dp(10)
    spacing: dp(12)

    canvas.before:
        Color:
            rgba: root.theme_cls.primaryColor if root.selected else root.theme_cls.transparentColor
        RoundedRectangle:
            radius: [dp(12), ]
            pos: root.pos
            size: root.size

    MDIcon:
        icon: root.panel_icon if root.panel_icon else ""
        opacity: 1 if root.panel_icon else 0
        size_hint: None, None
        size: dp(20), dp(20)

    MDLabel:
        text: root.panel_title
        adaptive_height: True
        shorten: True
        shorten_from: "right"
        theme_text_color: "Custom"
        text_color: self.theme_cls.onPrimaryColor if root.selected else self.theme_cls.onSurfaceVariantColor


<MKVSettingsTop>:
    orientation: "vertical"
    nav_axis: "x"
    nav_container: nav
    nav_items_box: nav.items_container
    content_container: content

    MKVSettingsNav:
        id: nav
        axis: "x"

    MDBoxLayout:
        id: content
        orientation: "vertical"


<MKVSettingsRight>:
    orientation: "horizontal"
    nav_axis: "y"
    nav_container: nav
    nav_items_box: nav.items_container
    content_container: content_container

    MDBoxLayout:
        orientation: "vertical"
        size_hint_x: 1

        MKVScrollView:

            MKVList:
                id: content_container

    MKVSettingsNav:
        id: nav
        axis: "y"
        size_hint_x: None


<MKVSettingItemBase>:
    on_release: root.open_dialog()

    MKVListItemLeadingIcon:
        icon: root.icon

    MKVListItemHeadlineText:
        text: root.title

    MKVListItemSupportingText:
        text: root.subtitle


<MKVSettingBooleanItem>:
    on_release: root.toggle()

    MDSwitch:
        id: value_switch
        active: bool(root.value)
        disabled: not root.enabled
        on_active:
            root.commit_value(self.active) if bool(root.value) != bool(self.active) else None


<MKVSettingStringItem>:
    MDBoxLayout:
        id: trailing_container
        adaptive_width: True
        spacing: dp(8)

        MDLabel:
            text: root.display_value
            theme_text_color: "Custom"
            text_color: self.theme_cls.onSurfaceVariantColor
            adaptive_height: True
            shorten: True
            shorten_from: "right"
            size_hint_x: None
            width: min(dp(160), self.texture_size[0])

        MDIconButton:
            icon: "pencil"
            disabled: not root.enabled
            on_release: root.open_dialog()


<MKVSettingPathItem>:
    MDBoxLayout:
        id: trailing_container
        adaptive_width: True
        spacing: dp(8)

        MDLabel:
            text: root.display_value
            theme_text_color: "Custom"
            text_color: self.theme_cls.onSurfaceVariantColor
            adaptive_height: True
            shorten: True
            shorten_from: "left"
            size_hint_x: None
            width: min(dp(200), self.texture_size[0])

        MDIconButton:
            icon: "folder"
            disabled: not root.enabled
            on_release: root.open_dialog()


<MKVSettingColorItem>:
    MDBoxLayout:
        id: trailing_container
        adaptive_width: True
        spacing: dp(12)

        MDBoxLayout:
            size_hint: None, None
            size: dp(32), dp(32)
            radius: [dp(8), ]
            md_bg_color: get_color_from_hex(root.value) if root.value else (1, 1, 1, 1)

        MDLabel:
            text: root.display_value
            theme_text_color: "Custom"
            text_color: self.theme_cls.onSurfaceVariantColor
            adaptive_height: True
            shorten: True
            shorten_from: "right"
            size_hint_x: None
            width: min(dp(120), self.texture_size[0])

        MDIconButton:
            icon: "eyedropper"
            disabled: not root.enabled
            on_release: root.open_dialog()


<MKVSettingsDialogBase>:
    auto_dismiss: False

    MKVDialogHeadlineText:
        text: root.dialog_title
        opacity: 1 if root.dialog_title else 0
        size_hint_y: None
        height: self.texture_size[1] if root.dialog_title else 0


<MKVSettingsStringDialog>:
    input_field: input_field

    MKVDialogSupportingText:
        text: root.validation_error
        opacity: 1 if root.validation_error else 0
        size_hint_y: None
        height: self.texture_size[1] if root.validation_error else 0

    MKVDialogContentContainer:
        MDTextField:
            id: input_field
            text: root.current_value or ""
            helper_text: root.validation_error
            helper_text_mode: "on_error"
            on_text:
                root.update_current_value(self.text, trigger_commit=root.commit_mode == "on_validate")
            on_text_validate: root.confirm()

    MKVDialogButtonContainer:
        MDButton:
            on_release: root.dismiss()
            MDButtonText:
                text: root.cancel_text

        MDButton:
            disabled:
                root.commit_mode != "on_validate" and bool(root.validation_error)
            on_release: root.confirm()
            MDButtonText:
                text: root.confirm_text


<MKVSettingsPathDialog>:
    input_field: input_field

    MKVDialogSupportingText:
        text: root.validation_error
        opacity: 1 if root.validation_error else 0
        size_hint_y: None
        height: self.texture_size[1] if root.validation_error else 0

    MKVDialogSupportingText:
        text: ", ".join(root.filters) if root.filters else ""
        opacity: 1 if root.filters else 0
        size_hint_y: None
        height: self.texture_size[1] if root.filters else 0

    MKVDialogContentContainer:
        MDTextField:
            id: input_field
            text: root.current_value or ""
            helper_text: root.validation_error
            helper_text_mode: "on_error"
            on_text:
                root.update_current_value(self.text, trigger_commit=root.commit_mode == "on_validate",)
            on_text_validate: root.confirm()

    MKVDialogButtonContainer:
        MDButton:
            on_release: root.dismiss()

            MDButtonText:
                text: root.cancel_text

        MDButton:
            disabled:
                root.commit_mode != "on_validate" and bool(root.validation_error)
            on_release: root.confirm()

            MDButtonText:
                text: root.confirm_text


<MKVSettingsColorDialog>:
    hex_field: hex_field
    preview_box: preview_box

    MKVDialogSupportingText:
        text: root.validation_error
        opacity: 1 if root.validation_error else 0
        size_hint_y: None
        height: self.texture_size[1] if root.validation_error else 0

    MKVDialogContentContainer:
        MDBoxLayout:
            orientation: "horizontal"
            adaptive_height: True
            spacing: dp(12)

            MDTextField:
                id: hex_field
                text: root.current_value or "#FFFFFFFF"
                helper_text: root.validation_error
                helper_text_mode: "on_error"
                on_text: root.update_current_value(self.text.strip(), trigger_commit=True)
                on_text_validate: root.confirm()

            MDBoxLayout:
                id: preview_box
                size_hint: None, None
                size: dp(36), dp(36)
                radius: [dp(10), ]
                md_bg_color:
                    get_color_from_hex(root.current_value) if root.current_value else (1, 1, 1, 1)

    MKVDialogButtonContainer:
        MDButton:
            on_release: root.dismiss()
            MDButtonText:
                text: root.cancel_text

        MDButton:
            disabled:
                root.commit_mode != "on_validate" and bool(root.validation_error)
            on_release: root.confirm()
            MDButtonText:
                text: root.confirm_text
